---
title: "The Mastermind of Pep Guardiola"
Author: "Will Orser and Floyd Krom"
output: html_notebook
  html_document:
    keep_md: TRUE
    toc: TRUE
    toc_float: TRUE
    theme: journal
    df_print: paged
    code_download: true
---

```{r libraries}
library(tidyverse)     # for data cleaning and plotting
library(googlesheets4) # for reading googlesheet data
library(lubridate)     # for date manipulation
library(openintro)     # for the abbr2state() function
library(palmerpenguins)# for Palmer penguin data
library(maps)          # for map data
library(ggmap)         # for mapping points on maps
library(gplots)        # for col2hex() function
library(RColorBrewer)  # for color palettes
library(sf)            # for working with spatial data
library(leaflet)       # for highly customizable mapping
library(ggthemes)      # for more themes (including theme_map())
library(plotly)        # for the ggplotly() - basic interactivity
library(gganimate)     # for adding animation layers to ggplots
library(gifski)        # for creating the gif (don't need to load this library every time,but need it installed)
library(transformr)    # for "tweening" (gganimate)
library(shiny)         # for creating interactive apps
library(patchwork)     # for nicely combining ggplot2 graphs  
library(gt)            # for creating nice tables
library(rvest)         # for scraping data
library(robotstxt)     # for checking if you can scrape data
gs4_deauth()           # To not have to authorize each time you knit.
library(readr)
theme_set(theme_minimal())
```

```{r}
season_1314 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1314_csv.csv")
season_1415 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1415_csv.csv")
season_1516 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1516_csv.csv")
season_1617 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1617_csv.csv")
season_1718 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1718_csv.csv")
season_1819 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1819_csv.csv")
```


**Introduction**

**Pep Guardiola**
Pep Guardiola is one of the greatest tactical masterminds of modern football. He is a coach who possesses all the skills and experience to transform any team into a dominating champion in any worldwide competition. As a manager, he holds the record for the most consecutive league games won in La Liga, the Bundesliga and the Premier League. 

Guardiola spent the majority of his career as a defensive midfielder for Barcelona. Johan Cruyff transformed Barcelona with Guardiola in a central role into a celebrated champion as they won the club's first European Cup in 1992 and four La Liga titles from 1991 to 1994. He also captained Barcelona from 1997 until his departure from Bareclona in 2001. He played 47 caps for the Spanish national team, and was part of the team at the 1994 World Cup and Euro 2000. After his retirement as player, he became coach of Barcelona B and after being appointed as manager of Barcelona's first team in May 2008. Guardiola immediately transformed the Barcelona team by telling key players Ronaldinho, Deco, Samuel Eto'o, and others that they wouldn't be part of his plans. He then signed Dani Ales and Gerard Piqué, while he promoted Sergio Busquets and Pedro to his team. These players would later be key to the team that dominated modern football for years. In his first season at Barcelona, he guided the team to the treble of La Liga, La Copa del Rey, and the UEFA Champions League, making him the youngest manager to ever accomplish this. When he left the club, he had won 14 honours as manager of Barcelona, a historical club record. 

*[Source: https://www.kicker.de/fc-bayern-muenchen/team-trainer/bundesliga/2013-14]*
*[Source: https://www.nytimes.com/2018/04/06/sports/soccer/manchester-city-united-pep-guardiola.html]*
*[Source: ]*

After a short sabbatical and an intensive German language course, Guardiola was announced as the new manager of Bayern Munich in 2013. During his time at one of the greatest clubs in the history of football, Guardiola won the Bundesliga in three consecutive seasons, including two domestic doubles. 

While Guardiola won a domestic double in his final year at Bayern Munich in 2016, Manchester City only managed to seal the fourth place in the English Premier League that season to qualify for a spot in next year's Champions League. In February of that year, Manchester City announced the appointment of Pep Guardiola for the upcoming season in England which many blame for their collapse in all four competitions. Before Pep's arrival was announced, Manchester City were only three points short on the first place in the Premier League. At the end of the season, they finished 15 points apart from champion Leicester City and only just qualified for the group stage of the Champions League. 

*[Source: https://www.manchestereveningnews.co.uk/sport/football/football-news/man-city-pellegrini-guardiola-destabilising-11336011]*

During Guardiola's first year as a Manchester City manager, he signed critical players, such as Oleksandr Zinchenko, Leroy Sané, İlkay Gündoğan, Claudio Bravo, and Gabriel Jesus. Guardiola is known for transforming the playing style of any new team he manages which requires critical signings that fit into his style of play. During a disappointing 2016-2017 season at Manchester City, Guardiola did not manage to win any trophies. However, Guardiola was able to identify the necessary changes to improve team in the battle for the Premier League title in the 2017-2018 season. He was able to make three acquisitions in the summer transfer window, goalkeeper Ederson Moraes, midfielder Bernardo Silva, as well as wingbacks Danilo, Banjamin Menday, and Kyle Walker, while dropping all four senior full backs from the team. The Manchester City squad had the fourth highest average squad age in the entire Premier League during the 2016-2017 season, which explains some of Guardiola's challenges during his first season. The signings in the lead up to the 2017-2018 season made Manchester City the 6th youngest squad in the league. 

In the weeks leading up to the final part of the 2017-2018 season, Guardiola had managed to put Manchester City into a position to break historical records in the Premier League . On 15 April 2018, Manchester City had officially won the Premier League with most wins (32) in Premier League history, most away wins (16) in Premier League history, most points (100) in Premier League history, most goals (106) in Premier League history. A historical Premier League title for Manchester City and the first for Guardiola in England. Manchester City also managed to win the EFL Cup with a 3-0 victory over Arsenal. However, they did not manage to qualify for the semifinal of the Champions League after losing against Liverpool in both legs of the quarterfinal. 

During Guardiola's third season as manager, he signed attacking midfielder Riyad Mahrez from Leicester City for a fee of £60 million. Manchester City had become accustomed to Guardiola's style of play and dominated the Premier League in the previous season. They immediately started their season with a prize, the 2018 FA Community Shield on August 5 with a victory over Chelsea. In the 2018-2019 season, Guardiola faced one of his biggest challenges as a manager of Manchester City, In order to win the title, Manchester City had to win 14 games in a row. Guardiola said "one of the toughest titles in all my career, by far". However, after 38 games, Manchester City was on top of the league with 98 points, one point above Liverpool. Another season with 32 wins and a respective 95 goals scored. Besides the FA Community Shield and Premier League title, Manchester City also managed to win the FA Cup and became one of the first ever men's team in England to win the domestic treble. 

After two consecutive Premier League titles, 



**Guardiola's Style of Play*

*General*
High % possession
High number of passes completed
Pushing outside backs into the attack to provide crosses
Playing out from the back 
Pressing/winning the ball back quickly 
  
*2016-2017 season*
- Pep struggled to find his best XI during the 2016-2017 season and used 8 different formations in 38 matches. 
- Most often it was a 433, Kevin de Bruyne and David Silva were assigned the "free 8" roles in the midfield, advancing to the 10 positions in possession and drawing back to the 8 positions in defense.  
- Number 6 drops in between the CBs, Kolarov as a left-footed left center back was able to distribute the ball to both wingers as he average most long balls per match for Manchester City during this season (4.2 average)
- At Barcelona and Bayern Munich, Pep Guardiola had full backs who were capable of dominating the entire left and right flank, however, during the 2016-2017 season at Manchester City, Guardiola's full backs were at age and incapable of fitting into the desired style of play. 
- Playing 3-2-5 in attack -> 2 CBs and the "6" in the back line, both full backs in front of them to secure the midfield, pushing up Kevin de Buryne and Silva into the advanced 10 positions in support of the attacking front 3 players. This was done in possession with the aim to congest the center of the field to prevent counterattacks. 
- One of the main challenges in build up play were both full-backs who controlled the midfield in front of the 2 center backs and number 6 as they were not good enough on the ball which slowed down the ball progression and therefore the attack. 
- However, there was overall improvement in the 2016-2017 season as Manchester City scored more goals, had a higher possession percentage, and a higher passing average per game than during the 2015-2016 season with Pellegrini. 
- Ultimately, Manchester City lost in the fourth round of the Carabao Cup, the semi-fianls of the F.A. Cup, and the round of 16 of the Champions League. On top of all of this, they were only able to secure the third place in the Premier League 15 points behind Premier League champion Chelsea. 

**2017-2018 season**
- 5-3-2 formation because the fullbacks were able to dominate the entire flank and therefore fit better into Guardiola's style of play
- However, due to an early season injury of Mendy, the Manchester City left back, Pep Guardiola changed back to the 4-3-3 formation transforming midfielder Delph into a left-back. 
- New goalkeeper Ederson Moraes became vital in Guardiola's style of play as he was able to comfortably become part of Manchester City's possession game building out from the back as well as play long range passes with extreme precision. This allowed Manchester City to immediately break pressure from the opponent in their own half when needed with Ederson playing a long range pass over the top allowing their forwards to make penetrating runs behind. 
- In their build-up play, the Manchester City full backs were a key part. Left-back Delph would tuck into the midfield, having a 3-player backline with Walker to the right of the center back. This allowed Fernandinho to get possession in the midfield instead of dropping in between the two center backs like he had done during the 2016-2017 season. During the 2017-2018, Fernandinho had a steep increase in his number of passesf rom 68 to 88 per game and thus dictated Manchester City's play. 
- The Delph and Fernandinho combination in the midfield in possession increased the build up pace compared to the Sagna & Clichy combination in the previous season, one of the many challenges Pep Guardiola faced. At the same time, right-back Kyle Walker had a better understanding of his role as a full-back and was able to determine when to stay as a center-back and whent to push higher up to join the attack and be able to cross. 
- Both Kevin de Bruyne and David Silva kept a similar role like in the 2016-2017 season, but now had the ability to come into a position to influence the opponent's midfielders and entire defense line with their play. They were able to choose between a penetrating pass to the wingers behind the opponent's backline, a combination pass with the striker, a cross from the side of the box, or a shot on goal. 
- The key changes to Manchester City's style of play and the signings at the start of the season that fit into this style of play brought Manchester City a season with historical records:
  + 32 wins (most in Premier League history)
  + 16 away wins (most in Premier League history)
  + 100 points (most in Premier League history)
  + 106 goals (most in Premier League history)
  + 19 point title winning margin (biggest in Premier League history)
- They also managed to win the EFL cup, but were knocked out of the Champions League quarterfinal by Liverpool. 

**2018-2019 season**

```{r}
season_1314 <- season_1314 %>%
  select(2:23)
season_1415 <- season_1415 %>%
  select(2:23)
season_1516 <- season_1516 %>%
  select(2:23)
season_1617 <- season_1617 %>%
  select(2:23)
season_1718 <- season_1718 %>%
  select(2:23)
season_1819 <- season_1819 %>%
 select(2:23)
```

```{r}
season_1314 %>%
  filter(HomeTeam == "Man City" | AwayTeam == "Man City") %>%
  arrange(Date) %>%
  mutate(HomePoints = case_when(FTR == "H" ~ 3,
                                FTR == "A" ~ 0,
                                FTR == "D" ~ 1),
         AwayPoints = case_when(FTR == "H" ~ 0,
                                FTR == "A" ~ 3,
                                FTR == "D" ~ 1),
         HomeGame = case_when(HomeTeam == "Man City" ~ TRUE,
                              HomeTeam != "Man City" ~ FALSE)) %>%
  group_by(HomeGame) %>%
  summarize(TotalHomePoints = sum(HomePoints),
            TotalAwayPoints = sum(AwayPoints))
```

