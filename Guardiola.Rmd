---
title: "The Tactical Mastermind of Pep Guardiola"
author: "Will Orser & Floyd Krom"
output: 
  html_document:
    keep_md: TRUE
    toc: TRUE
    toc_float: TRUE
    theme: journal
    df_print: paged
    code_download: true
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE, error=TRUE, message=FALSE, warning=FALSE)
```

```{r libraries, include=FALSE}
library(tidyverse)     # for data cleaning and plotting
library(googlesheets4) # for reading googlesheet data
library(lubridate)     # for date manipulation
library(openintro)     # for the abbr2state() function
library(palmerpenguins)# for Palmer penguin data
library(maps)          # for map data
library(ggmap)         # for mapping points on maps
library(gplots)        # for col2hex() function
library(RColorBrewer)  # for color palettes
library(sf)            # for working with spatial data
library(leaflet)       # for highly customizable mapping
library(ggthemes)      # for more themes (including theme_map())
library(plotly)        # for the ggplotly() - basic interactivity
library(gganimate)     # for adding animation layers to ggplots
library(gifski)        # for creating the gif (don't need to load this library every time,but need it installed)
library(transformr)    # for "tweening" (gganimate)
library(shiny)         # for creating interactive apps
library(patchwork)     # for nicely combining ggplot2 graphs  
library(gt)            # for creating nice tables
library(rvest)         # for scraping data
library(robotstxt)     # for checking if you can scrape data
gs4_deauth()           # To not have to authorize each time you knit.
library(readr)
theme_set(theme_minimal())
library(ggExtra)
library(ggtext)
```

```{r, include=FALSE}
season_1314 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1314_csv.csv")
season_1415 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1415_csv.csv")
season_1516 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1516_csv.csv")
season_1617 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1617_csv.csv")
season_1718 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1718_csv.csv")
season_1819 <- read_csv("~/Desktop/Intro to Data Science/Guardiola/Datasets/english-premier-league_zip/data/season-1819_csv.csv")
```


# I. Introduction

  Pep Guardiola is considered to be one of the greatest tactical masterminds in modern football. He is a coach who possesses all the skills and experience to transform any team into a dominant champion in any worldwide competition. As a manager, Guardiola holds the record for the most consecutive league games won in La Liga (Spain), the Bundesliga (Germany), and the English Premier League. Guardiola has managed to win a total of 30 trophies in his career as manager of Barcelona, Bayern Munich, and his current club, Manchester City. How did Guardiola change the style of play and influence the performance of English football club Manchester City after his appointment as manager in July 2016?  

  The purpose of this study is to perform a comparative analysis of the style of play and performance of the football club Manchester City before and after the appointment of Pep Guardiola. We will evaluate data from the 2013-14 season through the 2018-19 season. During the first three seasons covered in our analysis (2013-14, 2014-15, 2015-16), Manuel Pellegrini was manager of Manchester City, leading them to one Premier League title in the 2013-14 season. Following the removal of Pelligrini in June 2016, Pep Guardiola was appointed manager and was expected to completely change Manchester City's style of play with his world famous Tika-Taka style.

  In order to answer our primary research question, we will explore the following secondary research questions:
  
· How did Manchester City perform during Pellegrini's tenure as manager compared to during Guardiola's tenure?

· How did Manchester City perform offensively over the seasons?

· How did Manchester City perform defensively over the seasons?


  As football players and fans, it is hard not to admire the characteristic style of play of Guardiola's teams and the way he is consistently able to build his teams into the dominant force in their respective leagues. In the documentary "All or Nothing: Manchester City", it is crystal clear that Guardiola has a remarkable obsession with the tactical side of soccer and the style of play of his side. Everything Guardiola does as a manager seems to stem from an almost pathological attention to detail. As any football player will tell you, small details, performed consistently over time, can make the difference needed to crown a team champion at the end of the season. We are motivated to achieve a better understanding of these details through this analysis. 

  This study is divided into six sections. The following section includes a biography of Pep Guardiola, including his time as a professional football player and as a coach. Next, we will then present the style of play Guardiola has implemented at Manchester City and how it has changed over the seasons. We will then introduce our data before analyzing the results of various statistical transformations and visualizations. In the fifth section, we will summarize our findings and provide limitations and future research possibilities as an extension to this study. 


**II. Pep Guardiola**

  Guardiola spent the majority of his playing career as a defensive midfielder for Spanish club Barcelona. Johan Cruyff, one of football's most legendary players, as manager of Barcelona, transformed the club into a celebrated champion, with Guardiola playing a central role, as they won the club's first ever European Cup in 1992 and four La Liga titles from 1991 to 1994. Guardiola also captained Barcelona from 1997 until his departure from the club in 2001. He earned 47 caps (appearances) for the Spanish national team, and was part of the team at the 1994 World Cup and Euro 2000. After his retirement as a player, Guardiola became the coach of Barcelona B. After being appointed as manager of Barcelona's first team in May 2008, Guardiola immediately made his mark by telling key players like Ronaldinho, Deco, and Samuel Eto'o that they were not part of his plans. Guardiola then went on to sign defenders Dani Alves and Gerard Piqué, and promoted youth players Sergio Busquets and Pedro to the first team. All three of these players would go on to be key figures in Barcelona's era of dominance in modern football. In his first season at Barcelona, Guardiola guided his side to the treble: winning La Liga, La Copa del Rey, and the UEFA Champions League. This feat made him the youngest ever manager to accomplish this. When Guardiola left the club in 2012, he had won 14 trophies as manager of Barcelona, a historical club record. 

*[Source: https://www.kicker.de/fc-bayern-muenchen/team-trainer/bundesliga/2013-14]*

*[Source: https://www.nytimes.com/2018/04/06/sports/soccer/manchester-city-united-pep-guardiola.html]*

After a short sabbatical and an intensive German language course, Guardiola was announced as the new manager of Bayern Munich in 2013. During his time at one of the greatest clubs in the history of football, Guardiola won the Bundesliga in three consecutive seasons, including two domestic doubles. 

While Guardiola's Bayern side won a domestic double in his final year in 2016, Manchester City only managed to take fourth place in the English Premier League. The fourth place finish qualified City for a spot in next season's Champions League, an annual club football competition contested by the top clubs in Europe. In February of 2016, Manchester City announced the appointment of Pep Guardiola as manager for their upcoming season. Many blame the subpar performance of Manchester City during the 2015-16 season and the failure of Manuel Pelligrini during his final season in charge on this mid-season announcement of Guardiola's impending arrival. Before Pep's appointment was announced, Manchester City were only three points short of first place in the Premier League. By the end of the season, they had fell 15 points behind champion Leicester City and only barely qualified for the group stage of next season's Champions League. During Pellegrini's tenure at Manchester City from 2013 to 2016, he managed to win one Premier League title and two League Cups. 

*[Source: https://www.manchestereveningnews.co.uk/sport/football/football-news/man-city-pellegrini-guardiola-destabilising-11336011]*

During Guardiola's first year as a Manchester City manager, he signed critical players, such as Oleksandr Zinchenko, Leroy Sané, İlkay Gündoğan, Claudio Bravo, and Gabriel Jesus. Guardiola is known for transforming the playing style of any new team he manages. Doing so requires making signings that fit into his desired style of play and plan for the team. During a disappointing 2016-17 season at Manchester City, Guardiola did not manage to win any trophies. However, his first season in charge allowed him to identify the changes necessary to improve the team in the battle for the Premier League title in the upcoming 2017-18 season. He made new acquisitions in the summer transfer window, signing goalkeeper Ederson Moraes, midfielder Bernardo Silva, as well as full-backs Danilo, Benjamin Mendy, and Kyle Walker, while dropping all four senior full backs from his team. The Manchester City squad had the fourth highest average squad age in the entire Premier League during the 2016-17 season, which explains some of Guardiola's challenges during his first season in charge. The signings made in the lead up to the 2017-18 season made Manchester City the 6th youngest squad in the league. 

In the weeks leading up to the final part of the 2017-18 season, Guardiola had managed to put Manchester City in a position to break several Premier League records. On 15 April 2018, Manchester City won the Premier League with the most wins (32) in league history, most away wins (16) in league history, most points (100) in league history, and the most goals (106) in league history. 2017-18 was a historical Premier League season for Manchester City and Guardiola's first title in England. Manchester City also managed to win the EFL Cup with a 3-0 victory over Arsenal. However, City were knocked out of the Champions League after losing both legs of their quarterfinal against Liverpool. 

During Guardiola's third season in charge, he signed attacking midfielder Riyad Mahrez from Leicester City for a fee of £60 million. Manchester City had fully adapted Guardiola's style of play and dominated the Premier League in the previous season. They immediately started their 2018-19 season with a trophy, the 2018 FA Community Shield, with a victory over Chelsea. In the 2018-19 season, Guardiola faced one of his biggest challenges as the manager of Manchester City. In order to win the title, Manchester City had to win 14 games in a row. Guardiola called it one of the toughest challenges in all his career. However, after all 38 games were played, Manchester City was once again on top of the league with 98 points, one point above Liverpool. City finished the 2018-19 season with 32 wins and an impressive 95 goals scored. Besides the FA Community Shield and Premier League title, Manchester City also managed to win the FA Cup and became one of the first ever men's teams in England to win the domestic treble. 


**III. Guardiola's Style of Play**

*General*

The style of play characteristic of teams coached by Pep Guardiola can be summarized by five pillars:

1. A high percentage of possession.

2. A high number of passes completed and a high percentage of passes completed.

3. Pushing the full-backs high into the attack to provide crosses.

4. An ability to keep possession under high pressure and to play the ball out from the back. 

5. Pressing and winning the ball back quickly once they lose possession. 

*Guardiola's Style of Play over The Years*

Below, we will identify key elements of Manchester City's team and how their style of play changed over the different seasons with Guardiola as manager.
  
*2016-2017 Season*

· Pep struggled to find his best XI during the 2016-17 season and experimented with eight different formations in 38 Premier League matches. 

· Most often, Manchester City played in a 4-3-3 formation. In this formation, Kevin de Bruyne and David Silva were assigned the "free 8" roles in the midfield, advancing to the "10" (attacking midfield) positions in possession and drawing back to the "6" (defensive midfield) positions in defense.  

· When Manchester City had possession in their own half, the defensive midfielder, Fernandinho, dropped in between the two center-backs, who spread wide. Kolarov, as a left-footed left center-back was able to distribute the ball to both wingers as he averaged the most long passes per match for Manchester City during the 2016-17 season (4.2 long passes per game on average).

· At Barcelona and Bayern Munich, Pep Guardiola had full-backs who were capable of dominating the entire left and right flank. However, during the 2016-17 season with Manchester City, Guardiola's full-backs were older players who proved to be incapable of fitting into his desired style of play. 

· Guardiola played with a 3-2-5 formation in attack with the two center-backs and the "6" in the back, both full-backs in front of them to secure the midfield, pushing up the "8s" (box-to-box midfield), Kevin de Bruyne and David Silva, into advanced "10" positions in support of the attacking front 3 players. This was done in possession in the opponent's half of the field with the aim of congesting the center of the field in order to prevent counterattacks. 

· One of the main challenges in this season was build-up play. Both full-backs who controlled the midfield in possession were not good enough on the ball, which slowed down the ball progression and therefore hindered City's attack. 

· Despite facing these challenges, there was an overall improvement in the 2016-17 season as Manchester City scored more goals, had a higher average possession percentage, and a higher passing average per game than during the 2015-16 season under Pellegrini. 

· Ultimately, Manchester City lost in the fourth round of the Carabao Cup, the semi-finalls of the FA Cup, and the Round of 16 of the Champions League. On top of all of this, they were only able to secure third place in the Premier League, finishing 15 points behind Premier League champion Chelsea. 

*2017-2018 Season*

· With the signings of full-backs Danilo, Benjamin Mendy, and Kyle Walker, Pep Guardiola changed to a 5-3-2 formation. He was able to change from a 4-3-3 formation to a 5-3-2 formation because his full-backs were able to dominate the entire flank and therefore fit better into Guardiola's desired style of play.

· Due to an early season injury of Mendy (the left full-back), Pep Guardiola changed back to the 4-3-3 formation while transforming central midfielder Fabian Delph into a left full-back. 

· New goalkeeper Ederson Moraes became vital in Guardiola's style of play as he was able to comfortably become part of Manchester City's possession game, building out from the back as well as playing long range passes with extreme precision. This allowed Manchester City to easily break pressure from the opponent in their own half with Ederson playing accurate long range passes over the opponent's lines, allowing the City forwards to make penetrating runs behind. 

· In Manchester City's build-up play, the full-backs played a key role. Left-back Delph would tuck into the midfield, creating a three-player back line with Walker to the right of the center-backs. This allowed Fernandinho to get possession in the midfield instead of dropping in between the two center-backs like he had done during the 2016-17 season. During the 2017-18 season, Fernandinho increased in his average number of passes per game from 68 to 88, and thus was able to dictate City's build-up play. 

· The Delph and Fernandinho combination in midfield increased the speed of City's build-up play compared to the duo of Bacary Sagna & Gael Clichy in the previous season. At the same time, right-back Kyle Walker had a better understanding of his role as a full-back and was able to determine when to stay behind as a center-back and when to push higher up to join the attack and serve crosses. 

· Both Kevin de Bruyne and David Silva kept similar roles to the 2016-17 season, but now had the ability to come into positions to influence the opponent's midfielders and entire defense line with their play. They were able to choose between making penetrating passes to their wingers behind the opponent's back line, combination passes with the striker, crossing from the outside the box, and taking direct shots on goal. 

· The key changes to Manchester City's style of play and the new signings that fit into this style of play brought Manchester City a historic season:

  - 32 wins (most in Premier League history)
  
  - 16 away wins (most in Premier League history)
  
  - 100 points (most in Premier League history)
  
  - 106 goals (most in Premier League history)
  
  - 19 point title winning margin (biggest in Premier League history)
  
· Manchester City and Pep Guardiola also managed to win the EFL cup during this season, but were knocked out of the Champions League quarterfinal by Premier League opponent, Liverpool.

*2018-2019 Season*

· For this season, Guardiola only signed attacking midfielder Mahrez and kept a very similar first team squad compared to the previous season.

· Guardiola made minor tweaks to his style of play rather than major changes as his team had become more accustomed to his football philosophy. One of the tweaks he made was to increase the involvement of full-backs Kyle Walker and Oleksandr Zinchenko. Zinchenko's speed allowed him to dominate the left flank more consistently than Delph had in the previous season. This allowed wingers Raheem Sterling and Leroy Sané to play more centrally (closer to the box), with Walker and Zichenko providing crosses from wide positions. 

· Injury challenges during this season forced Guardiola to pivot his starting XI and change their style of play. He would often play Fernandinho as a center-back instead of as a defensive midlfielder and start Aymeric LaPorte as a left-back instead of his usual position of center-back. In possession, Fernandinho would be able to overload the midfield, dictating the build-up play with the support of David Silva, City's central midfielder.

· Manchester City continued to dominate competitions in England, winning the Premier League, Carabao Cup, and the FA Cup, to become one of the first ever men's teams in England to win the domestic treble.

*[Source: https://www.youtube.com/watch?v=1gHq-yspmso]*


**IV. Data**

In order to examine how the style of play and performance of football club Manchester City changed after the appointment of their current manager, Pep Guardiola, data from the 2013-14 season through the 2018-19 season has been drawn from Football Data – a football portal providing historical data on any competition worldwide, that includes information on every Premier League game. Football Data provides all data sets in Excel and CSV format for quantitative analysis. The variables in this Premier League data set include:

· Date = Match Date (dd/mm/yy)

· Time = Time of match kick off

· HomeTeam = Home Team

· AwayTeam = Away Team

· FTHG and HG = Full Time Home Team Goals

· FTAG and AG = Full Time Away Team Goals

· FTR and Res = Full Time Result (H=Home Win, D=Draw, A=Away Win)

· HTHG = Half Time Home Team Goals

· HTAG = Half Time Away Team Goals

· HTR = Half Time Result (H=Home Win, D=Draw, A=Away Win)

· Attendance = Crowd Attendance

· Referee = Match Referee

· HS = Home Team Shots

· AS = Away Team Shots

· HST = Home Team Shots on Target

· AST = Away Team Shots on Target

· HHW = Home Team Hit Woodwork

· AHW = Away Team Hit Woodwork

· HC = Home Team Corners

· AC = Away Team Corners

· HF = Home Team Fouls Committed

· AF = Away Team Fouls Committed

· HFKC = Home Team Free Kicks Conceded

· AFKC = Away Team Free Kicks Conceded

· HO = Home Team Offsides

· AO = Away Team Offsides

· HY = Home Team Yellow Cards

· AY = Away Team Yellow Cards

· HR = Home Team Red Cards

· AR = Away Team Red Cards

· HBP = Home Team Bookings Points (10 = yellow, 25 = red)

· ABP = Away Team Bookings Points (10 = yellow, 25 = red)

In order to perform the ideal analysis of Guardiola's impact at Manchester City, we would have liked to perform an analysis of the following variables in addition to those in our Football Data data set: passes (total), passes per game, pass accuracy %, crosses, cross accuracy %, saves, tackles, tackle success %, blocked shots, interceptions, clearances, duels won, and errors leading to goal. This would have allowed us to perform a more thorough analysis of Guardiola's change to City's style of play as well as the team's performance during his time as manager. 

**V. Results**
```{r, include=FALSE}
season_1314 <- season_1314 %>%
  select(2:23)
season_1415 <- season_1415 %>%
  select(2:23)
season_1516 <- season_1516 %>%
  select(2:23)
season_1617 <- season_1617 %>%
  select(2:23)
season_1718 <- season_1718 %>%
  select(2:23)
season_1819 <- season_1819 %>%
 select(2:23)
```

```{r, include=FALSE}
all_seasons <- bind_rows(list(`season1314` = season_1314, `season1415` = season_1415, `season1516`= season_1516, `season1617` = season_1617, `season1718` = season_1718, `season1819`= season_1819), .id = "season")

all_seasons <- all_seasons %>% 
  mutate(season = recode(season, season1314 = "2013-14", season1415 = "2014-15", season1516 = "2015-16", season1617 = "2016-17", season1718 = "2017-18", season1819 = "2018-19"))
```


**Secondary Questions**
**How did Manchester City perform during Pellegrini's tenure as manager compared to during Guardiola's tenure? -> Will**

  To start our analysis of Pep Guardiola's impact on the style of play and performance of Manchester City after his appointment in 2016, we will attempt to answer our secondary research questions. 
  
  First: How did Manchester City perform during Guardiola's tenure as manager compared to during Pelligrini's tenure? We will use the total points earned by Manchester City in the Premier League in the final three seasons of Pellegrini's tenure (2013-14, 2014-15, 2015-16) and in the first three seasons of Guardiola's tenure (2016-17, 2017-18, 2018-19) as the primary comparison point. 

```{r, include=FALSE}
all_seasons %>%
  filter(HomeTeam == "Man City" | AwayTeam == "Man City") %>%
  mutate(GameLocation = case_when(HomeTeam == "Man City" ~ "Home",
                              HomeTeam != "Man City" ~ "Away")) %>%
  mutate(Manager = case_when(season %in% c("2013-14", "2014-15", "2015-16") ~ "Pellegrini",
                              season %in% c("2016-17", "2017-18", "2018-19") ~ "Guardiola")) %>%
  group_by(season, GameLocation, Manager) %>%
  summarize(across(where(is.numeric),~sum(.x)))
```

**Total points [total, home, away] - all seasons**
```{r}
all_seasons %>%
  filter(HomeTeam == "Man City" | AwayTeam == "Man City") %>%
  mutate(HomePoints = case_when(FTR == "H" ~ 3,
                                FTR == "A" ~ 0,
                                FTR == "D" ~ 1),
         AwayPoints = case_when(FTR == "H" ~ 0,
                                FTR == "A" ~ 3,
                                FTR == "D" ~ 1),
         HomeGame = case_when(HomeTeam == "Man City" ~ TRUE,
                              HomeTeam != "Man City" ~ FALSE),
         TotalHomePoints = case_when(HomeGame == TRUE ~ HomePoints),
         TotalAwayPoints = case_when(HomeGame == FALSE ~ AwayPoints)) %>%
  mutate(Manager = case_when(season %in% c("2013-14", "2014-15", "2015-16") ~ "Pellegrini",
                              season %in% c("2016-17", "2017-18", "2018-19") ~ "Guardiola")) %>%
  group_by(season, Manager) %>%
  summarize(TotalHomePoints = sum(TotalHomePoints, na.rm = TRUE),
            TotalAwayPoints = sum(TotalAwayPoints, na.rm = TRUE),
            TotalPoints = TotalHomePoints + TotalAwayPoints) -> PointsTable

PointsTable
```

**Total Points by Season**
```{r, echo=FALSE}
PointsTable %>%
  ggplot(aes(x = season, y = TotalPoints, fill = Manager)) +
  geom_col() +
  geom_text(aes(label = TotalPoints), position = position_dodge(width = 0.9), color = "White", vjust = -0.25) +
  facet_wrap(~fct_relevel(Manager, "Pellegrini"), scales = "free_x") +
  labs(title = "Total Points Earned by Season", x = "", y = "") +
  scale_fill_manual(values = c("#B9D6F2", "#0353A4"), labels = c("Pellegrini", "Guardiola")) +
  removeGrid(x = TRUE, y = TRUE) +
  theme(plot.title.position = "plot", plot.background = element_rect(fill = "#061A40"), plot.title = element_markdown(size = 15, face = "bold", color = "White"), legend.position = "none", axis.text = element_text(color = "White"), axis.title.x.top = element_text(color = "White"), strip.text = element_text(size = 12, face = "italic", color = "#061A40"), strip.background.x = element_rect(fill = "grey"))
  
```

The bar chart above displays the total points earned by Manchester City in their final three seasons under Pelligrini and in their first three seasons under Guardiola. From a cursory look at the graph, it is clear that overall, Manchester City earned more points in their seasons under Guardiola than in their seasons under Pelligrini. The two highest total point seasons for Manchester City come in 2017-18 and 2018-19, their second and third years under Guardiola, respectively.

**Average Points Statistics**

```{r}
#Average Points Earned in a Season by Manager, Average PPG by Manager, Average Points per Game (PPG) by Season
PointsTable %>% 
  group_by(Manager) %>% 
  mutate(AverageManagerPoints = mean(TotalPoints), AverageManagerPPG = sum(TotalPoints)/ (38*3)) %>% 
  ungroup(Manager) %>% 
  group_by(season) %>% 
  mutate(AverageSeasonPPG = TotalPoints/38) %>% 
  select(season, Manager, AverageManagerPoints, AverageManagerPPG, AverageSeasonPPG) -> AveragePointsTable

AveragePointsTable
```

To gain more insight into City's total points under the two managers, we calculated a few averages: the average points earned by each manager, Manchester City's average points per game (PPG) by season, and the average PPG for each manager.

In their final three seasons under Pelligrini, Manchester City earned an average of 77 points. In their first three seasons under Guardiola, the club earned an average of 92 points.

In terms of PPG, Manchester City had their highest PPG in the 2017-18 season (2.63; Guardiola), their second highest PPG in the 2018-19 season (2.58; Guardiola), and their third highest PPG in the 2013-14 season (2.26; Pelligrini). It is interesting to note that in each of these three seasons, Manchester City finished as Premier League champions.

Manchester City's average PPG under Pelligrini was 2.02, while under Guardiola, their average PPG was 2.42. 

Next, we look at the points Manchester City earns in matches played at home and in matches played away from home. 

**Total Home and Away Points by Season**
```{r}
TotalPointsTable <- PointsTable %>% 
  mutate(Manager = case_when(season %in% c("2013-14", "2014-15", "2015-16") ~ "Pellegrini",
                              season %in% c("2016-17", "2017-18", "2018-19") ~ "Guardiola")) %>%
  pivot_longer(cols = c(TotalHomePoints, TotalAwayPoints),
               names_to = "Location",
               values_to = "Points") %>% 
  select(season, Location, Points, Manager)

TotalPointsTable
```

```{r, echo=FALSE}
TotalPointsTable %>% 
  ggplot(aes(x = season, y = Points, fill = Location)) +
  geom_col(position = "dodge") +
  facet_wrap(~fct_relevel(Manager, "Pellegrini"), scales = "free_x") +
  geom_text(aes(label = Points), position = position_dodge(width = 0.9), color = "White", vjust = -0.4) +
  labs(title = "Total Points Earned at <span style='color:#B9D6F2'>Home</span> and <span style='color:#0353A4'>Away</span> by Season", 
       x = "", y = "", 
       fill = "Where were points earned?") +
  scale_fill_manual(values = c("#0353A4", "#B9D6F2"), labels = c("Total Away Points", "Total Home Points")) +
  removeGrid(x = TRUE, y = TRUE) +
  theme(plot.title.position = "plot", plot.background = element_rect(fill = "#061A40"), plot.title = element_markdown(size = 15, face = "bold", color = "White"), legend.position = "none", axis.text = element_text(color = "White"), axis.title.x.top = element_text(color = "White"), strip.text = element_text(size = 12, face = "italic", color = "#061A40"), strip.background.x = element_rect(fill = "grey"))
```

At first glance, it is not immediately clear whether there are trends in the graph above. However, if we focus only on points earned away from home (navy blue bars), it is clear that under Guardiola, Manchester City fared much better than under Pellegrini. In each of the first three seasons with Guardiola as manager, City's points earned away exceeded their points earned away in all of their final three seasons under Pelligrini (including the 2013-14 season in which City earned 86 total points and finished as champions). 

In terms of points earned at home, differences between the two managers are not so clear. But, it is interesting to notice the trend within City's three seasons under each each manager. In the final seasons under Pelligrini, Manchester City's points earned at home decrease steadily: from 52 to 45 and finally to 38. In their first three seasons under Guardiola, City's home points increase steadily: from 40 to 50 and then to 54.

**Average Home/Away Points Statistics**

```{r}
#Average Points Earned at Home by Manager, Average Home PPG by Manager, Average Home PPG by Season
TotalPointsTable %>% 
  filter(Location == "TotalHomePoints") %>% 
  group_by(Manager) %>% 
  mutate(AverageManagerHomePoints = mean(Points), AverageManagerHomePPG = sum(Points)/(19 * 3)) %>% 
  ungroup() %>% 
  group_by(season) %>% 
  mutate(AverageSeasonHomePPG = Points/19) -> AverageHomePointsTable


#Average Points Earned Away by Manager, Average Away PPG by Manager, Average Away PPG by Season
TotalPointsTable %>% 
  filter(Location == "TotalAwayPoints") %>% 
  group_by(Manager) %>% 
  mutate(AverageManagerAwayPoints = mean(Points), AverageManagerAwayPPG = sum(Points)/(19 * 3)) %>% 
  ungroup() %>% 
  group_by(season) %>% 
  mutate(AverageSeasonAwayPPG = Points/19) ->AverageAwayPointsTable


AverageHomePointsTable %>% 
  left_join(AverageAwayPointsTable, by = c("season", "Manager")) -> AverageHomeAwayPointsTable


AverageHomeAwayPointsTable %>% 
  select(season, Manager, AverageManagerHomePoints, AverageManagerAwayPoints, AverageSeasonHomePPG, AverageSeasonAwayPPG, AverageManagerHomePPG, AverageManagerAwayPPG) -> FinalHomeAwayPointsTable

FinalHomeAwayPointsTable
```

To compare City's points earned at home and away under each manager in more depth, we calculated a few averages: the average points earned at home/away by each manager, the average home/away PPG by season, and the average home/away PPG by manager.

Manchester City's average home points under Pelligrini was 45. Under Guardiola, it was 48. City's average away points under Pelligrini was 32. Under Guardiola, this number jumps to 44.

Manchester City's highest average home PPG occurred in the 2018-19 season (2.84; Guardiola), the second highest average home PPG in 2013-14 (2.74; Pelligrini), and the third highest in 2017-18 (2.63; Guardiola). Manchester City's highest average away PPG occurred in the 2017-18 season (2.63; Guardiola), the second highest in 2018-19 (2.32; Guardiola), and the third highest in 2016-17 (2.00; Guardiola).

Manchester City's average home PPG in their final three seasons under Pelligrini was 2.37. Their average home PPG in their first three seasons under Guardiola was 2.53. City's average away PPG under Pelligrini was a mere 1.68, while under Guardiola it was 2.32.


**Passes per match [total]**

Our second secondary research question regards the differences in Manchester City's passing statistics under Pelligrini and under Guardiola. Before performing any analysis of the data, we anticipated that passing statistics would be a point of major difference between the two managers. As we mentioned earlier, Guardiola's sides are notorious for maintaining a high percentage of ball possession in matches, completing a high number of passes in their matches (with a high passing percentage), and winning the ball back quickly once they lose it. Pelligrini's sides typically do not do these things to nearly the same extent.   

```{r, include=FALSE}
library(readxl)
Man_City_Stats_PL_Website <- read_excel("Man City Stats PL Website.xlsx")
```

```{r}
Man_City_Stats_PL_Website <- Man_City_Stats_PL_Website %>%
    mutate(Manager = case_when(Season %in% c("2013-14", "2014-15", "2015-16") ~ "Pellegrini",
                              Season %in% c("2016-17", "2017-18", "2018-19") ~ "Guardiola"))

Man_City_Stats_PL_Website
```

```{r}
Man_City_Stats_PL_Website %>%
  select(Season, Manager, Passes, `Passes per match`, `Pass accuracy (%)`, Interceptions) %>%
  ggplot(aes(x = Season, y = `Passes per match`, fill = Manager)) +
  geom_col() +
  geom_text(aes(label = `Passes per match`), color = "White", vjust = -0.25) +
  facet_wrap(~fct_relevel(Manager, "Pellegrini"), scales = "free_x") +
  labs(title = "Passes per Match by Season", x = "", y = "") +
  scale_fill_manual(values = c("#B9D6F2", "#0353A4")) +
  removeGrid(x = TRUE, y = TRUE) +
  theme(plot.title.position = "plot", plot.background = element_rect(fill = "#061A40"), plot.title = element_markdown(size = 15, face = "bold", color = "White"), legend.position = "none", axis.text = element_text(color = "White"), axis.title.x.top = element_text(color = "White"), strip.text = element_text(size = 12, face = "italic", color = "White"), strip.background.x = element_rect(fill = "grey"))
```

The graph above utilizes data taken from the official Premier League website and illustrates Manchester City's average passes per match in each of their final three seasons under Pelligrini and each of their first three seasons under Guardiola. As you can see, our initial prediction regarding the differences in passing statistics between Pelligrini's and Guardiola's side proved to be correct. In Guardiola's first season in charge (2016-17), City's average passes per match was 597.53. This number is higher than in any of their final three seasons under Pelligrini, despite being by far the lowest average passes per match in any of Guardiola's first three seasons. After the 2016-17 season, City's average passes per match jumps up dramatically (by more than 100 passes per match) to 743.18 in 2017-18 and 699.5 in 2018-19. This considerable increase in average passes per match indicates Guardiola's success in adapting Manchester City's style of play to his possession-oriented style, after his first season where City played a style more similar to the one they had under Pelligrini. 


**Average Passing Statistics**

```{r}
#Average Passes per Season under each Manager, Average Passes per Match under each Manager, Average Pass Accuracy under each Manager
Man_City_Stats_PL_Website %>%
  group_by(Manager) %>%
  mutate(AverageSeasonPassesManager = mean(Passes), AverageMatchPassesManager = mean(`Passes per match`),               AveragePassAccuracyManager = mean(`Pass accuracy (%)`)) %>% 
  select(Season, Manager, AverageSeasonPassesManager, AverageMatchPassesManager, AveragePassAccuracyManager) -> AveragePassingTable

AveragePassingTable
```

To examine the differences in Manchester City's passing statistics during Pelligrini's and Guardiola's tenures in more depth, we calculated three more average passing statistics: average passes per season under each manager, average passes per match under each manager, and average pass accuracy under each manager.

In Pelligrini's final three seasons in charge, Manchester City averaged 21,118.67 passes per season. In Guardiola's first three seasons in charge, City averaged 25,842.67 passes per season, a difference of more than 4,500 passes.

Under Pelligrini, Manchester City averaged 555.72 passes per match. Under Guardiola, this number jumps to 680.07, a difference of more than 120 passes per match.

Under Pelligrini, Manchester City maintained an average pass accuracy of 84.67%. Under Guardiola, City's average pass accuracy was 88.00%, a difference of 3.33%. While this may seem like an inconsequential difference, it is important to remember that Guardiola's teams are completing on average more than 120 passes per match more than Pelligrini's teams, which makes their higher pass accuracy all the more impressive.

All in all, an analysis of Manchester City's passing statistics in the final three years of Pelligrini's tenure and the first three years of Guardiola's tenure yielded the results we were expecting. City's significantly higher average passes per match and their higher passing accuracy percentage under Guardiola illustrates how Guardiola was able to mold the team in accordance with his possession-oriented philosophy. Guardiola transformed Manchester City into a club that dominated possession, relied on short, accurate passes to move the ball around the field, and pressed relentlessly to win the ball back when they turned it over.  


**How did Manchester City perform offensively over the seasons? -> Floyd**

**Goals for [total, home, away]**
```{r}
all_seasons %>%
  filter(HomeTeam == "Man City" | AwayTeam == "Man City") %>%
  mutate(Game = case_when(HomeTeam == "Man City" ~ "Home",
                              HomeTeam != "Man City" ~ "Away")) %>%
  mutate(Manager = case_when(season %in% c("2013-14", "2014-15", "2015-16") ~ "Pellegrini",
                              season %in% c("2016-17", "2017-18", "2018-19") ~ "Guardiola")) %>%
  group_by(season, Game, Manager) %>%
  summarize(across(where(is.numeric),~sum(.x))) %>%
  mutate(GoalsFor = ifelse(Game == "Home", FTHG, FTAG)) %>%
  select(season, Game, GoalsFor, Manager) %>%
  pivot_wider(names_from = Game,
              values_from = GoalsFor, names_prefix = "GoalsFor") %>%
  mutate(TotalGoalsFor = GoalsForAway + GoalsForHome) -> GoalsForTable

GoalsForTable
```

```{r, echo=FALSE}
GoalsForTable %>% 
  ggplot(aes(x = season, y = TotalGoalsFor, fill = Manager)) +
  geom_col() +
  geom_text(aes(label = TotalGoalsFor), color = "White", vjust = -0.25) +
  facet_wrap(~fct_relevel(Manager, "Pellegrini"), scales = "free_x") +
  labs(title = "Total Goals For by Season", x = "", y = "") +
  scale_fill_manual(values = c("#B9D6F2", "#0353A4")) +
  removeGrid(x = TRUE, y = TRUE) +
  theme(plot.title.position = "plot", plot.background = element_rect(fill = "#061A40"), plot.title = element_markdown(size = 15, face = "bold", color = "White"), legend.position = "none", axis.text = element_text(color = "White"), axis.title.x.top = element_text(color = "White"), strip.text = element_text(size = 12, face = "italic", color = "White"), strip.background.x = element_rect(fill = "grey"))
```

**Total shots [total, home, away]**
```{r}
all_seasons %>%
  filter(HomeTeam == "Man City" | AwayTeam == "Man City") %>%
  mutate(Game = case_when(HomeTeam == "Man City" ~ "Home",
                              HomeTeam != "Man City" ~ "Away")) %>%
  mutate(Manager = case_when(season %in% c("2013-14", "2014-15", "2015-16") ~ "Pellegrini",
                              season %in% c("2016-17", "2017-18", "2018-19") ~ "Guardiola")) %>%
  group_by(season, Game, Manager) %>%
  summarize(across(where(is.numeric),~sum(.x))) %>%
  mutate(Shots = ifelse(Game == "Home", HS, AS)) %>%
  mutate(ShotsTarget = ifelse(Game == "Home", HST, AST)) %>%
  select(season, Game, Shots, Manager) %>%
  pivot_wider(names_from = Game,
              values_from = Shots, names_prefix = "Shots") %>%
  mutate(TotalShots = ShotsAway + ShotsHome) -> TotalShotsTable

TotalShotsTable
```


**Total shots on target[total, home, away]**
```{r}
all_seasons %>%
  filter(HomeTeam == "Man City" | AwayTeam == "Man City") %>%
  mutate(Game = case_when(HomeTeam == "Man City" ~ "Home",
                              HomeTeam != "Man City" ~ "Away")) %>%
  mutate(Manager = case_when(season %in% c("2013-14", "2014-15", "2015-16") ~ "Pellegrini",
                              season %in% c("2016-17", "2017-18", "2018-19") ~ "Guardiola")) %>%
  group_by(season, Game, Manager) %>%
  summarize(across(where(is.numeric),~sum(.x))) %>%
  mutate(ShotsTarget = ifelse(Game == "Home", HST, AST)) %>%
  select(season, Game, ShotsTarget, Manager) %>%
  pivot_wider(names_from = Game,
              values_from = ShotsTarget, names_prefix = "ShotsTarget") %>%
  mutate(TotalShotsTarget = ShotsTargetAway + ShotsTargetHome) -> TotalShotsTargetTable

TotalShotsTargetTable
```

```{r}
TotalShotsTable %>% 
  left_join(TotalShotsTargetTable, by = c("season", "Manager")) -> ShotAccuracyTable
```

```{r, echo=FALSE}
ShotAccuracyTable %>% 
  ggplot(aes(x = season, y = TotalShots, fill = Manager)) +
  geom_col() +
  geom_text(aes(label = TotalShots), color = "White", vjust = -0.4) +
  facet_wrap(~fct_relevel(Manager, "Pellegrini"), scales = "free_x") +
  labs(title = "Total Shots by Season", x = "", y = "") +
  scale_fill_manual(values = c("#B9D6F2", "#0353A4")) +
  removeGrid(x = TRUE, y = TRUE) +
  theme(plot.title.position = "plot", plot.background = element_rect(fill = "#061A40"), plot.title = element_markdown(size = 15, face = "bold", color = "White"), legend.position = "none", axis.text = element_text(color = "White"), axis.title.x.top = element_text(color = "White"), strip.text = element_text(size = 12, face = "italic", color = "White"), strip.background.x = element_rect(fill = "grey"))
```

```{r, echo=FALSE}
ShotAccuracyTable %>% 
  ggplot(aes(x = season, y = TotalShotsTarget, fill = Manager)) +
  geom_col() +
  geom_text(aes(label = TotalShotsTarget), color = "White", vjust = -0.25) +
  facet_wrap(~fct_relevel(Manager, "Pellegrini"), scales = "free_x") +
  labs(title = "Total Shots on Target by Season", x = "", y = "") +
  scale_fill_manual(values = c("#B9D6F2", "#0353A4")) +
  removeGrid(x = TRUE, y = TRUE) +
  theme(plot.title.position = "plot", plot.background = element_rect(fill = "#061A40"), plot.title = element_markdown(size = 15, face = "bold", color = "White"), legend.position = "none", axis.text = element_text(color = "White"), axis.title.x.top = element_text(color = "White"), strip.text = element_text(size = 12, face = "italic", color = "White"), strip.background.x = element_rect(fill = "grey"))
```

**Average Shots on Target Statistics**

```{r}
#Average Shots on Target Proportion by Manager, Average Home/Away Shots on Target Proportion by Manager, Average Shots on Target Proportion by Season, and Average Home/Away Shots on Target Proportion by Season
ShotAccuracyTable %>% 
  group_by(Manager) %>% 
  mutate(AverageSOTManager = sum(TotalShotsTarget) / sum(TotalShots), AverageHomeSOTManager = sum(ShotsTargetHome) / sum(ShotsHome), AverageAwaySOTManager = sum(ShotsTargetAway) / sum(ShotsAway)) %>% 
  ungroup(Manager) %>% 
  group_by(season) %>% 
  mutate(AverageSOTSeason = TotalShotsTarget / TotalShots, AverageHomeSOTSeason = ShotsTargetHome / ShotsHome, AverageAwaySOTSeason = ShotsTargetAway / ShotsAway) %>% 
  select(season, Manager, AverageSOTManager, AverageHomeSOTManager, AverageAwaySOTManager, AverageSOTSeason, AverageHomeSOTSeason, AverageAwaySOTSeason) -> AverageSOTTable

AverageSOTTable
```

**Crosses by season [total]**

```{r, echo=FALSE}
Man_City_Stats_PL_Website %>%
    mutate(Manager = case_when(Season %in% c("2013-14", "2014-15", "2015-16") ~ "Pellegrini",
                              Season %in% c("2016-17", "2017-18", "2018-19") ~ "Guardiola")) %>%
  select(Season, Manager, Crosses, `Passes per match`, `Cross accuracy (%)`, Interceptions) %>%
  ggplot(aes(x = Season, y = Crosses, fill = Manager)) +
  geom_col() +
  geom_text(aes(label = `Crosses`), color = "White", vjust = -0.25) +
  facet_wrap(~fct_relevel(Manager, "Pellegrini"), scales = "free_x") +
  labs(title = "Crosses by Season", x = "", y = "") +
  scale_fill_manual(values = c("#B9D6F2", "#0353A4")) +
  removeGrid(x = TRUE, y = TRUE) +
  theme(plot.title.position = "plot", plot.background = element_rect(fill = "#061A40"), plot.title = element_markdown(size = 15, face = "bold", color = "White"), legend.position = "none", axis.text = element_text(color = "White"), axis.title.x.top = element_text(color = "White"), strip.text = element_text(size = 12, face = "italic", color = "White"), strip.background.x = element_rect(fill = "grey"))
```


**How did Manchester City perform defensively over the seasons? - Floyd**

**Goals against [total, home, away]**
```{r}
all_seasons %>%
  filter(HomeTeam == "Man City" | AwayTeam == "Man City") %>%
  mutate(Game = case_when(HomeTeam == "Man City" ~ "Home",
                              HomeTeam != "Man City" ~ "Away")) %>%
  mutate(Manager = case_when(season %in% c("2013-14", "2014-15", "2015-16") ~ "Pellegrini",
                              season %in% c("2016-17", "2017-18", "2018-19") ~ "Guardiola")) %>%
  group_by(season, Game, Manager) %>%
  summarize(across(where(is.numeric),~sum(.x))) %>%
  mutate(GoalsAgainst = ifelse(Game == "Home", FTAG, FTHG)) %>%
  select(season, Game, GoalsAgainst, Manager) %>%
  pivot_wider(names_from = Game,
              values_from = GoalsAgainst, names_prefix = "GoalsAgainst") %>%
  mutate(TotalGoalsAgainst = GoalsAgainstAway + GoalsAgainstHome) -> GoalsAgainstTable

GoalsAgainstTable
```

```{r, echo=FALSE}
GoalsAgainstTable %>% 
  ggplot(aes(x = season, y = TotalGoalsAgainst, fill = Manager)) +
  geom_col() +
  geom_text(aes(label = TotalGoalsAgainst), color = "White", vjust = -0.25) +
  facet_wrap(~fct_relevel(Manager, "Pellegrini"), scales = "free_x") +
  labs(title = "Total Goals Against by Season", x = "", y = "") +
  scale_fill_manual(values = c("#B9D6F2", "#0353A4")) +
  removeGrid(x = TRUE, y = TRUE) +
  theme(plot.title.position = "plot", plot.background = element_rect(fill = "#061A40"), plot.title = element_markdown(size = 15, face = "bold", color = "White"), legend.position = "none", axis.text = element_text(color = "White"), axis.title.x.top = element_text(color = "White"), strip.text = element_text(size = 12, face = "italic", color = "White"), strip.background.x = element_rect(fill = "grey"))
```

```{r, echo=FALSE}
Man_City_Stats_PL_Website %>%
  mutate(Manager = case_when(Season %in% c("2013-14", "2014-15", "2015-16") ~ "Pellegrini",
                              Season %in% c("2016-17", "2017-18", "2018-19") ~ "Guardiola")) %>%
  select(Season, Manager, Tackles, Interceptions, `Passes per match`, `Tackle success (%)`, Interceptions) %>%
  ggplot(aes(x = Season, y = Tackles, fill = Manager)) +
  geom_col() +
  geom_text(aes(label = Tackles), color = "White", vjust = -0.25) +
  geom_line(aes(x = Season, y = Interceptions), size = 1.5, color="red", group = 1) +
  labs(title = "Total Tackles and <span style='color:#A50104'>Interceptions</span> under <span style='color:#0353A4'>Pellegrini</span> and <span style='color:#B9D6F2'>Guardiola</span> by Season", x = "", y = "") +
  scale_fill_manual(values = c("#B9D6F2", "#0353A4")) +
  removeGrid(x = TRUE, y = TRUE) +
  theme(plot.title.position = "plot", plot.background = element_rect(fill = "#061A40"), plot.title = element_markdown(size = 14, face = "bold", color = "White"),legend.position = "none", axis.text = element_text(color = "White"), axis.title.x.top = element_text(color = "White"), strip.text = element_text(size = 12, face = "italic", color = "White"), strip.background.x = element_rect(fill = "grey"))
```


**VII. Conclusion**
**VIII. Bibliography**
